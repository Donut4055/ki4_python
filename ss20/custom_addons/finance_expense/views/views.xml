<odoo>
  <data>
    <record model="ir.ui.view" id="view_finance_expense_tree">
      <field name="name">finance.expense.tree</field>
      <field name="model">finance.expense</field>
      <field name="arch" type="xml">
        <tree string="Danh sách chi tiêu" decoration-success="is_paid == True" decoration-danger="is_paid == False">
          <field name="name"/>
          <field name="category_id"/>
          <field name="expense_type" widget="badge" decoration-success="expense_type == 'travel'" decoration-warning="expense_type == 'food'" decoration-muted="expense_type == 'other'"/>
          <field name="amount" widget="monetary" sum="Tổng chi tiêu"/>
          <field name="expense_date"/>
          <field name="is_paid" widget="boolean_toggle"/>
        </tree>
      </field>
    </record>

    <record model="ir.ui.view" id="view_finance_expense_form">
      <field name="name">finance.expense.form</field>
      <field name="model">finance.expense</field>
      <field name="arch" type="xml">
        <form string="Chi tiêu">
          <sheet>
            <div class="oe_title">
              <h1>
                <field name="name" placeholder="Tên chi tiêu..." required="1"/>
              </h1>
            </div>
            <group>
              <group string="Thông tin chi tiêu">
                <field name="category_id" options="{'no_create': False, 'no_open': False}"/>
                <field name="expense_type" widget="radio"/>
                <field name="amount" widget="monetary"/>
                <field name="total_line_amount" widget="monetary"/>
              </group>
              <group string="Trạng thái">
                <field name="expense_date" widget="date"/>
                <field name="is_paid" widget="boolean_toggle"/>
              </group>
            </group>
            
            <group>
              <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color', 'no_create_edit': False}"/>
            </group>
            
            <notebook>
              <page string="Chi tiết khoản chi" name="expense_lines">
                <field name="expense_line_ids">
                  <tree editable="bottom">
                    <field name="sequence" widget="handle"/>
                    <field name="name"/>
                    <field name="quantity"/>
                    <field name="unit_price" widget="monetary"/>
                    <field name="subtotal" widget="monetary" sum="Tổng cộng"/>
                    <field name="note"/>
                  </tree>
                </field>
              </page>
              
              <page string="Thông tin chung" name="general_info">
                <group>
                  <group string="Chi tiết">
                    <field name="expense_type"/>
                    <field name="amount"/>
                  </group>
                  <group string="Ngày tháng">
                    <field name="expense_date"/>
                  </group>
                </group>
              </page>
              
              <page string="Thanh toán" name="payment_info">
                <group>
                  <field name="is_paid"/>
                  <field name="expense_date" string="Ngày thanh toán"/>
                </group>
              </page>
              
              <page string="Ghi chú" name="notes">
                <group>
                  <field name="approval_note" placeholder="Nhập ghi chú duyệt chi..." nolabel="1"/>
                </group>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <record model="ir.ui.view" id="view_finance_expense_search">
      <field name="name">finance.expense.search</field>
      <field name="model">finance.expense</field>
      <field name="arch" type="xml">
        <search string="Tìm kiếm chi tiêu">
          <field name="name" string="Tên" filter_domain="[('name', 'ilike', self)]"/>
          <field name="category_id"/>
          <field name="tag_ids" string="Thẻ"/>
          <field name="expense_type"/>
          <field name="expense_date"/>
          <field name="amount"/>
          <field name="approval_note" string="Ghi chú"/>
          
          <separator/>
          
          <filter string="Hôm nay" name="filter_today" domain="[('expense_date', '=', context_today().strftime('%Y-%m-%d'))]"/>
          <filter string="Tuần này" name="filter_this_week" domain="[('expense_date', '&gt;=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d')), ('expense_date', '&lt;=', (context_today() + datetime.timedelta(days=6-context_today().weekday())).strftime('%Y-%m-%d'))]"/>
          <filter string="Tháng này" name="filter_this_month" domain="[('expense_date', '&gt;=', context_today().strftime('%Y-%m-01'))]"/>
          
          <separator/>
          
          <group expand="1" string="Trạng thái thanh toán">
            <filter string="Đã thanh toán" name="filter_paid" domain="[('is_paid', '=', True)]"/>
            <filter string="Chưa thanh toán" name="filter_unpaid" domain="[('is_paid', '=', False)]"/>
          </group>
          
          <group expand="1" string="Loại chi tiêu">
            <filter string="Đi chuyển" name="filter_travel" domain="[('expense_type', '=', 'travel')]"/>
            <filter string="Ăn uống" name="filter_food" domain="[('expense_type', '=', 'food')]"/>
            <filter string="Khác" name="filter_other" domain="[('expense_type', '=', 'other')]"/>
          </group>
          
          <group expand="0" string="Nhóm theo">
            <filter string="Danh mục" name="group_by_category" context="{'group_by': 'category_id'}"/>
            <filter string="Loại chi tiêu" name="group_by_type" context="{'group_by': 'expense_type'}"/>
            <filter string="Trạng thái thanh toán" name="group_by_paid" context="{'group_by': 'is_paid'}"/>
            <filter string="Ngày chi tiêu" name="group_by_date" context="{'group_by': 'expense_date'}"/>
            <filter string="Thẻ" name="group_by_tags" context="{'group_by': 'tag_ids'}"/>
          </group>
        </search>
      </field>
    </record>

    <record model="ir.actions.act_window" id="action_finance_expense">
      <field name="name">Chi tiêu</field>
      <field name="res_model">finance.expense</field>
      <field name="view_mode">tree,form</field>
      <field name="search_view_id" ref="view_finance_expense_search"/>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
          Tạo chi tiêu mới
        </p>
        <p>
          Nhấn vào nút "Tạo" để thêm chi tiêu mới.
        </p>
      </field>
    </record>

    <menuitem 
      id="menu_finance_expense_root" 
      name="Quản lý chi tiêu"
      sequence="10"/>

    <menuitem 
      id="menu_finance_expense_main" 
      name="Chi tiêu"
      parent="menu_finance_expense_root"
      sequence="10"/>

    <menuitem 
      id="menu_finance_expense_list" 
      name="Danh sách chi tiêu"
      parent="menu_finance_expense_main"
      action="action_finance_expense"
      sequence="10"/>

    <!-- Finance Category Views -->
    <record model="ir.ui.view" id="view_finance_category_tree">
      <field name="name">finance.category.tree</field>
      <field name="model">finance.category</field>
      <field name="arch" type="xml">
        <tree string="Danh sách danh mục">
          <field name="name"/>
          <field name="code"/>
          <field name="expense_count"/>
          <field name="total_amount" widget="monetary" sum="Tổng tiền"/>
          <field name="active" widget="boolean_toggle"/>
        </tree>
      </field>
    </record>

    <record model="ir.ui.view" id="view_finance_category_form">
      <field name="name">finance.category.form</field>
      <field name="model">finance.category</field>
      <field name="arch" type="xml">
        <form string="Danh mục chi tiêu">
          <sheet>
            <div class="oe_button_box" name="button_box">
              <button name="%(action_finance_expense)d" 
                      type="action" 
                      class="oe_stat_button" 
                      icon="fa-money"
                      context="{'default_category_id': active_id, 'search_default_category_id': active_id}">
                <field name="expense_count" widget="statinfo" string="Chi tiêu"/>
              </button>
            </div>
            <widget name="web_ribbon" title="Archived" bg_color="bg-danger" invisible="active"/>
            <div class="oe_title">
              <h1>
                <field name="name" placeholder="Tên danh mục..." required="1"/>
              </h1>
            </div>
            <group>
              <group string="Thông tin cơ bản">
                <field name="code"/>
                <field name="active"/>
              </group>
              <group string="Thống kê">
                <field name="expense_count"/>
                <field name="total_amount" widget="monetary"/>
              </group>
            </group>
            <group string="Mô tả">
              <field name="description" placeholder="Nhập mô tả chi tiết về danh mục..." nolabel="1"/>
            </group>
            <notebook>
              <page string="Chi tiêu liên quan" name="expenses">
                <field name="expense_ids">
                  <tree>
                    <field name="name"/>
                    <field name="expense_type"/>
                    <field name="amount" widget="monetary"/>
                    <field name="expense_date"/>
                    <field name="is_paid" widget="boolean_toggle"/>
                  </tree>
                </field>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <record model="ir.ui.view" id="view_finance_category_search">
      <field name="name">finance.category.search</field>
      <field name="model">finance.category</field>
      <field name="arch" type="xml">
        <search string="Tìm kiếm danh mục">
          <field name="name" string="Tên" filter_domain="[('name', 'ilike', self)]"/>
          <field name="code"/>
          <field name="description"/>
          
          <separator/>
          
          <filter string="Đang hoạt động" name="filter_active" domain="[('active', '=', True)]"/>
          <filter string="Đã lưu trữ" name="filter_archived" domain="[('active', '=', False)]"/>
          
          <group expand="0" string="Nhóm theo">
            <filter string="Trạng thái" name="group_by_active" context="{'group_by': 'active'}"/>
          </group>
        </search>
      </field>
    </record>

    <record model="ir.actions.act_window" id="action_finance_category">
      <field name="name">Danh mục chi tiêu</field>
      <field name="res_model">finance.category</field>
      <field name="view_mode">tree,form</field>
      <field name="search_view_id" ref="view_finance_category_search"/>
      <field name="context">{'search_default_filter_active': 1}</field>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
          Tạo danh mục chi tiêu mới
        </p>
        <p>
          Nhấn vào nút "Tạo" để thêm danh mục chi tiêu mới.
        </p>
      </field>
    </record>

    <menuitem 
      id="menu_finance_category" 
      name="Danh mục"
      parent="menu_finance_expense_main"
      action="action_finance_category"
      sequence="20"/>

    <!-- Finance Tag Views -->
    <record model="ir.ui.view" id="view_finance_tag_tree">
      <field name="name">finance.tag.tree</field>
      <field name="model">finance.tag</field>
      <field name="arch" type="xml">
        <tree string="Danh sách thẻ">
          <field name="name"/>
          <field name="color" widget="color_picker"/>
          <field name="expense_count"/>
          <field name="active" widget="boolean_toggle"/>
        </tree>
      </field>
    </record>

    <record model="ir.ui.view" id="view_finance_tag_form">
      <field name="name">finance.tag.form</field>
      <field name="model">finance.tag</field>
      <field name="arch" type="xml">
        <form string="Thẻ/Nhãn">
          <sheet>
            <div class="oe_button_box" name="button_box">
              <button name="%(action_finance_expense)d" 
                      type="action" 
                      class="oe_stat_button" 
                      icon="fa-money"
                      context="{'search_default_tag_ids': active_id}">
                <field name="expense_count" widget="statinfo" string="Chi tiêu"/>
              </button>
            </div>
            <widget name="web_ribbon" title="Archived" bg_color="bg-danger" invisible="active"/>
            <div class="oe_title">
              <h1>
                <field name="name" placeholder="Tên thẻ..." required="1"/>
              </h1>
            </div>
            <group>
              <group string="Thông tin cơ bản">
                <field name="color" widget="color_picker"/>
                <field name="active"/>
              </group>
              <group string="Thống kê">
                <field name="expense_count"/>
              </group>
            </group>
            <group string="Mô tả">
              <field name="description" placeholder="Nhập mô tả chi tiết về thẻ..." nolabel="1"/>
            </group>
            <notebook>
              <page string="Chi tiêu liên quan" name="expenses">
                <field name="expense_ids">
                  <tree>
                    <field name="name"/>
                    <field name="category_id"/>
                    <field name="expense_type"/>
                    <field name="amount" widget="monetary"/>
                    <field name="expense_date"/>
                    <field name="is_paid" widget="boolean_toggle"/>
                  </tree>
                </field>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <record model="ir.ui.view" id="view_finance_tag_search">
      <field name="name">finance.tag.search</field>
      <field name="model">finance.tag</field>
      <field name="arch" type="xml">
        <search string="Tìm kiếm thẻ">
          <field name="name" string="Tên" filter_domain="[('name', 'ilike', self)]"/>
          <field name="description"/>
          
          <separator/>
          
          <filter string="Đang hoạt động" name="filter_active" domain="[('active', '=', True)]"/>
          <filter string="Đã lưu trữ" name="filter_archived" domain="[('active', '=', False)]"/>
          
          <group expand="0" string="Nhóm theo">
            <filter string="Trạng thái" name="group_by_active" context="{'group_by': 'active'}"/>
          </group>
        </search>
      </field>
    </record>

    <record model="ir.actions.act_window" id="action_finance_tag">
      <field name="name">Thẻ/Nhãn</field>
      <field name="res_model">finance.tag</field>
      <field name="view_mode">tree,form</field>
      <field name="search_view_id" ref="view_finance_tag_search"/>
      <field name="context">{'search_default_filter_active': 1}</field>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
          Tạo thẻ/nhãn mới
        </p>
        <p>
          Nhấn vào nút "Tạo" để thêm thẻ/nhãn mới cho chi tiêu.
        </p>
      </field>
    </record>

    <menuitem 
      id="menu_finance_tag" 
      name="Thẻ/Nhãn"
      parent="menu_finance_expense_main"
      action="action_finance_tag"
      sequence="30"/>

    <!-- Finance Expense Line Views -->
    <record model="ir.ui.view" id="view_finance_expense_line_tree">
      <field name="name">finance.expense.line.tree</field>
      <field name="model">finance.expense.line</field>
      <field name="arch" type="xml">
        <tree string="Danh sách chi tiết chi tiêu">
          <field name="sequence" widget="handle"/>
          <field name="expense_id"/>
          <field name="name"/>
          <field name="quantity"/>
          <field name="unit_price" widget="monetary"/>
          <field name="subtotal" widget="monetary" sum="Tổng cộng"/>
        </tree>
      </field>
    </record>

    <record model="ir.ui.view" id="view_finance_expense_line_form">
      <field name="name">finance.expense.line.form</field>
      <field name="model">finance.expense.line</field>
      <field name="arch" type="xml">
        <form string="Chi tiết khoản chi">
          <sheet>
            <group>
              <group string="Thông tin cơ bản">
                <field name="expense_id"/>
                <field name="sequence"/>
                <field name="name"/>
              </group>
              <group string="Số liệu">
                <field name="quantity"/>
                <field name="unit_price" widget="monetary"/>
                <field name="subtotal" widget="monetary"/>
              </group>
            </group>
            <group string="Ghi chú">
              <field name="note" placeholder="Nhập ghi chú bổ sung..." nolabel="1"/>
            </group>
          </sheet>
        </form>
      </field>
    </record>

    <record model="ir.ui.view" id="view_finance_expense_line_search">
      <field name="name">finance.expense.line.search</field>
      <field name="model">finance.expense.line</field>
      <field name="arch" type="xml">
        <search string="Tìm kiếm chi tiết chi tiêu">
          <field name="name" string="Mô tả" filter_domain="[('name', 'ilike', self)]"/>
          <field name="expense_id"/>
          
          <group expand="0" string="Nhóm theo">
            <filter string="Khoản chi tiêu" name="group_by_expense" context="{'group_by': 'expense_id'}"/>
          </group>
        </search>
      </field>
    </record>

    <record model="ir.actions.act_window" id="action_finance_expense_line">
      <field name="name">Chi tiết khoản chi</field>
      <field name="res_model">finance.expense.line</field>
      <field name="view_mode">tree,form</field>
      <field name="search_view_id" ref="view_finance_expense_line_search"/>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
          Tạo chi tiết khoản chi mới
        </p>
        <p>
          Nhấn vào nút "Tạo" để thêm chi tiết khoản chi mới.
        </p>
      </field>
    </record>

    <menuitem 
      id="menu_finance_expense_line" 
      name="Chi tiết khoản chi"
      parent="menu_finance_expense_main"
      action="action_finance_expense_line"
      sequence="40"/>

  </data>
</odoo>
